$Id$ -*-text-*-

Purpose: Description of radiative transfer codes and related programs

NB: INSTALL contains installation instructions for swnb2 and clm

This directory, ${HOME}/aca, contains various programs and scripts used
to study radiation in the atmosphere. By far the majority of these
files are concerned with solar radiation. This includes programs to
build cross section files, programs and scripts to read HITRAN and
automatically generate HITRAN-derived header files, and programs and
scripts to generate Malkmus narrow band parameters from HITRAN input.

The two most important programs here are:
"clm":	"clm" converts CoLuMn thermodynamic profiles from a variety of
input formats (CRM1, CRM2, AFGL, CLM) to a few output formats (CRM2
and CLM). "clm" attempts to automatically generate fields which are
not supplied, and allows significant tweaking of properties like
aerosol. 

"swnb": A Shortwave Narrow Band Model for radiative transfer (the
longwave portion does not yet work, or, more accurately, has not been
tested).  "swnb" uses input files generated by many, many, other
programs. Now deprecated in favor of swnb2.

"swnb2": Updated version of swnb based on DISORT2. 

"nbm": Next generation narrow band model. Not ready for prime time.

SWNB is documented in 
Zender, C. S., B. Bush, S. K. Pope, A. Bucholtz, W. D. Collins,
J. T. Kiehl, F. P. J. Valero, and J. Vitko Jr., Atmospheric absorption
during the Atmospheric Radiation Measurement (ARM) Enhanced Shortwave
Experiment (ARESE), J. Geophys. Res., 102(D25), 29901--29915, 1997.  

SWNB is used in 
1. Zender, C. S., Global climatology of abundance and solar absorption
of oxygen collision complexes, J. Geophys. Res., 104(D20),
24471--24484, 1999. 
2. Cess, Robert D., Minghua Zhang, Francisco P. J. Valero, Shelly
K. Pope, Anthony Bucholtz, Brett Bush, Charles S. Zender, John Vitko,
Jr., Absorption of solar radiation by the cloudy atmosphere: Further
interpretations of collocated aircraft measurements, J. Geophys. Res.,
104(D2), 2059-2066, 1999.
3. Valero, F. P. J., S. K. Pope, B. C. Bush, Q. Nguyen, D. Marsden,
R. D. Cess, A. Simpson-Leitner, A. Bucholtz, and P. M. Udelhofen, The
Absorption of Solar Radiation by the Clear and Cloudy Atmosphere
During the Atmospheric Radiation Measurements Enhanced Shortwave
Experiments (ARESE) I and II: Observations and Models,
J. Geophys. Res., 108(D1), 4016, doi:10.1029/2001JD001384, 2003. 

These programs were developed en masse for use in studies of
atmospheric absorption (e.g., ARESE) beginning in late 1994 when
enhanced absorption was still known as "Anomalous Cloud Absorption",
hence "aca". 

H2OH2O.F90	Generates (H2O)2 cross-sections
NO2.F90		Generates NO2 cross-sections
O2O2.F90	Generates O2-O2 and O2-N2 cross-sections
O3.F90		Generates O3 and O2 cross-sections
aca.pl*		Fancy Perl driver for SWNB
aca.pro		Old IDL scripts for SWNB output
aca.sh*		Simple shell script to regenerate SWNB datasets
aca.tex		1994 ARESE planning manuscript
bib_aca.tex	Enhanced absorption bibliography
clm.F90		CoLuMn thermodynamic model
disort2.f	DISORT used in SWNB2
drc_dff.i	Yorick script to compare SWNB direct to diffuse fields
etags.sh*	Generate Emacs tags
htrn.i		Yorick script to plot SWNB data
htrn2nb.F90	Convert HITRAN data to Malkmus narrow band parameters
htrn2nb.sh*	Simple driver for htrn2nb
htrn2nc.pl*	Convert HITRAN data to netCDF for input to htrn2nb
htrn2nc.sh*	Simple driver for htrn2nc
linpak.f	Used by DISORT
machine.F	Used by DISORT
mie2nc.F90	Convert BPB's Mie data to netCDF (obsolete)
nbm.F90		Narrow Band Model (successor to swnb2, still in beta)
rdhtrn.f	Subsets HITRAN files for narrow band parameters (obsolete)
sk.i		Yorick script for Stefan Kinne intercomparison
swnb.F		Shortwave Narrow Band Model (disort1-based, deprecated)
swnb2.F90	Shortwave Narrow Band Model (disort2-based, current)

Getting this entire radiative transfer suite to work together takes
some doing, as there are many library dependencies not contained in
the above files. Here is a (hopefully) a complete list of the
remaining dependencies:

Shell scripts:
bin/sh/pvmgetarch Used by Makefile

C programs:
c/date_time.c	C routines to handle date and time conversion
ck/htrn.c	Generates htrn_mdl.F90 from HITRAN molparam.txt

Libraries:
libcsz_f90.a	Fortran utility routines (interpolation, strings, etc)
libcsm_f90.a	Climate system model physics

These libraries comprise the following modules from ~/f: 
${HOME}/f/dbg_mdl.F90 \ # Begin libcsz_f90 modules
${HOME}/f/erf_mdl.F90 \
${HOME}/f/gmm_mdl.F90 \
${HOME}/f/mmr_mdl.F90 \
${HOME}/f/nf90_utl.F90 \
${HOME}/f/prn_mdl.F90 \
${HOME}/f/sng_mdl.F90 \
${HOME}/f/utl_mdl.F90 \
${HOME}/f/vec_mdl.F90 \
${HOME}/f/xtr_mdl.F90 \ # End libcsz_f90 modules
${HOME}/f/clm_mdl.F90 \ # Begin libcsm_f90 modules
${HOME}/f/dmr_mdl.F90 \
${HOME}/f/drv_cst_mdl.F90 \
${HOME}/f/flx_slr_mdl.F90 \
${HOME}/f/fnd_cst_mdl.F90 \
${HOME}/f/htrn_mdl.F90 \
${HOME}/f/phys_cst_mdl.F90 \
${HOME}/f/slr_crd_mdl.F90 \
${HOME}/f/rt_mdl.F90 \
${HOME}/f/tdy_mdl.F90 \
${HOME}/f/wvl_mdl.F90 # End libcsm_f90 modules

Francisco Valero and David Marsden asked for a copy of the model
Following script assembles all files required to build clm and swnb2
Assemble all required source and data files into one directory:

Create tarball http://dust.ess.uci.edu/swnb2/swnb2.tar.gz
/bin/rm -r ${DATA}/swnb2;mkdir ${DATA}/swnb2
/bin/cp -f \
${DATA}/aca/abs_xsx_H2OH2O.nc \
${DATA}/aca/abs_xsx_NO2.nc \
${DATA}/aca/abs_xsx_O2O2.nc \
${DATA}/aca/abs_xsx_O3.nc \
${DATA}/aca/aer_H2SO4_PaW75.nc \
${DATA}/aca/aer_dust_like.nc \
${DATA}/aca/aer_h2so4_215K.nc \
${DATA}/aca/aer_h2so4_300K.nc \
${DATA}/aca/aer_meteoric_dust.nc \
${DATA}/aca/aer_mineral_dust.nc \
${DATA}/aca/aer_saharan_dust.nc \
${DATA}/aca/aer_sulfate.nc \
${DATA}/aca/aer_volcanic_dust.nc \
${DATA}/aca/ice_05.nc \
${DATA}/aca/ice_20.nc \
${DATA}/aca/lqd_05.nc \
${DATA}/aca/lqd_07.nc \
${DATA}/aca/lqd_10.nc \
${DATA}/aca/mls_cld.nc \
${DATA}/aca/mls_cld.txt \
${DATA}/aca/mls_clr.nc \
${DATA}/aca/mls_clr.txt \
${DATA}/aca/mls_icrccm_92lvl.nc \
${DATA}/aca/mls_icrccm_92lvl.txt \
${DATA}/aca/nst_FSBR.nc \
${DATA}/aca/spc_Kur95_01wvn.nc \
${DATA}/aca/spc_Kur95_20wvn.nc \
${DATA}/aca/spc_LaN68.nc \
${DATA}/aca/spc_NeL84.nc \
${DATA}/aca/spc_ThD71.nc \
${DATA}/aca/swnb_CO2.nc \
${DATA}/aca/swnb_H2O.nc \
${DATA}/aca/swnb_O2.nc \
${DATA}/aca/swnb_OH.nc \
${DATA}/aca/trp_icrccm_92lvl.nc \
${DATA}/aca/trp_icrccm_92lvl.txt \
${HOME}/aca/ChangeLog \
${HOME}/aca/Makefile \
${HOME}/aca/README \
${HOME}/aca/bdref.f \
${HOME}/aca/clm.F90 \
${HOME}/aca/d1mach.f \
${HOME}/aca/disort2.f \
${HOME}/aca/linpak.f \
${HOME}/aca/r1mach.f \
${HOME}/aca/swnb2.F90 \
${HOME}/bin/sh/pvmgetarch \
${HOME}/c/date_time.c \
${HOME}/f/dbg_mdl.F90 \
${HOME}/f/erf_mdl.F90 \
${HOME}/f/gmm_mdl.F90 \
${HOME}/f/mmr_mdl.F90 \
${HOME}/f/nf90_utl.F90 \
${HOME}/f/prn_mdl.F90 \
${HOME}/f/sng_mdl.F90 \
${HOME}/f/utl_mdl.F90 \
${HOME}/f/vec_mdl.F90 \
${HOME}/f/xtr_mdl.F90 \
${HOME}/f/clm_mdl.F90 \
${HOME}/f/dmr_mdl.F90 \
${HOME}/f/drv_cst_mdl.F90 \
${HOME}/f/flx_slr_mdl.F90 \
${HOME}/f/fnd_cst_mdl.F90 \
${HOME}/f/htrn_mdl.F90 \
${HOME}/f/phys_cst_mdl.F90 \
${HOME}/f/slr_crd_mdl.F90 \
${HOME}/f/rt_mdl.F90 \
${HOME}/f/tdy_mdl.F90 \
${HOME}/f/wvl_mdl.F90 \
${DATA}/swnb2
cd ${DATA};tar cvzf /var/www/html/swnb2/swnb2.tar.gz ./swnb2

Note on *.nc input data files:
Generating these files requires bootstrapping the entire radiative
transfer machinery, processing HITRAN, Mie computations, etc.
It is not for the faint of heart.
Contact me if you are interested in the source to the rest of this.
